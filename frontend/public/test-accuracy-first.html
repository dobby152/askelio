<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Accuracy First Mode</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { border-left: 4px solid #4CAF50; }
        .error { border-left: 4px solid #f44336; }
        .info { border-left: 4px solid #2196F3; }
        .warning { border-left: 4px solid #FF9800; }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976D2; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .comparison-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .better { background-color: #e8f5e8; }
        .worse { background-color: #ffeaea; }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success { background: #4CAF50; color: white; }
        .status.error { background: #f44336; color: white; }
        .status.info { background: #2196F3; color: white; }
        .status.warning { background: #FF9800; color: white; }
    </style>
</head>
<body>
    <h1>üéØ Test Accuracy First Mode</h1>
    <p>Tento test ovƒõ≈ô√≠, ≈æe se nyn√≠ automaticky pou≈æ√≠v√° nejp≈ôesnƒõj≈°√≠ model pro zpracov√°n√≠ dokument≈Ø.</p>

    <div class="test-section info">
        <h2>üìä Porovn√°n√≠ re≈æim≈Ø zpracov√°n√≠</h2>
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>Re≈æim</th>
                    <th>Model/Provider</th>
                    <th>Oƒçek√°van√° p≈ôesnost</th>
                    <th>N√°klady</th>
                    <th>Rychlost</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr class="worse">
                    <td><strong>cost_optimized</strong><br><small>(star√Ω default)</small></td>
                    <td>GPT-4o Mini / Regex fallback</td>
                    <td>60-85%</td>
                    <td>0.043 Kƒç/dok</td>
                    <td>Rychl√Ω</td>
                    <td><span class="status error">Star√Ω</span></td>
                </tr>
                <tr class="better">
                    <td><strong>accuracy_first</strong><br><small>(nov√Ω default)</small></td>
                    <td>Claude 3.5 Sonnet / Gemini</td>
                    <td>90-95%</td>
                    <td>0.30 Kƒç/dok</td>
                    <td>Pomalej≈°√≠</td>
                    <td><span class="status success">Aktivn√≠</span></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="test-section success">
        <h2>‚úÖ Implementovan√© zmƒõny</h2>
        <ul>
            <li><strong>Frontend default mode</strong>: Zmƒõnƒõno z "cost_optimized" na "accuracy_first"</li>
            <li><strong>Upload komponenta</strong>: Automaticky se vybere "Nejvy≈°≈°√≠ p≈ôesnost (0.30 Kƒç/dok)"</li>
            <li><strong>Backend konfigurace</strong>: DEFAULT_PROCESSING_OPTIONS aktualizov√°ny</li>
            <li><strong>API endpoint</strong>: Podporuje accuracy_first mode</li>
        </ul>
    </div>

    <div class="test-section info">
        <h2>üß™ Test aktu√°ln√≠ch dokument≈Ø</h2>
        <button onclick="testCurrentDocuments()">Naƒç√≠st aktu√°ln√≠ dokumenty</button>
        <div id="documents-result">
            <span class="status info">ƒåek√° na test...</span>
        </div>
        <pre id="documents-details"></pre>
    </div>

    <div class="test-section info">
        <h2>üîç Test nov√©ho uploadu</h2>
        <p>Simulace uploadu s nov√Ωm accuracy_first nastaven√≠m:</p>
        <button onclick="simulateNewUpload()">Simulovat upload</button>
        <div id="upload-result">
            <span class="status info">ƒåek√° na test...</span>
        </div>
        <pre id="upload-details"></pre>
    </div>

    <div class="test-section warning">
        <h2>‚ö†Ô∏è Aktu√°ln√≠ omezen√≠</h2>
        <ul>
            <li><strong>OpenRouter API</strong>: Rate limit na free tier modelech</li>
            <li><strong>Gemini API</strong>: Dostupn√Ω, ale pou≈æ√≠v√° se jako fallback</li>
            <li><strong>Regex fallback</strong>: St√°le poskytuje 60% p≈ôesnost jako z√°lo≈æn√≠ ≈ôe≈°en√≠</li>
            <li><strong>N√°klady</strong>: Vy≈°≈°√≠ n√°klady za vy≈°≈°√≠ p≈ôesnost (0.30 Kƒç vs 0.043 Kƒç)</li>
        </ul>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000';

        window.testCurrentDocuments = async function() {
            const resultDiv = document.getElementById('documents-result');
            const detailsDiv = document.getElementById('documents-details');
            
            resultDiv.innerHTML = '<span class="status info">Naƒç√≠t√°n√≠ dokument≈Ø...</span>';
            detailsDiv.textContent = '';
            
            try {
                const response = await fetch(`${API_BASE_URL}/documents`);
                const documents = response.json();
                
                if (response.ok) {
                    const docs = await documents;
                    
                    // Analyze documents
                    const analysis = {
                        total: docs.length,
                        byProvider: {},
                        avgAccuracy: 0,
                        avgConfidence: 0,
                        latest: null
                    };
                    
                    let totalAccuracy = 0;
                    let totalConfidence = 0;
                    
                    docs.forEach(doc => {
                        const provider = doc.provider_used || 'unknown';
                        if (!analysis.byProvider[provider]) {
                            analysis.byProvider[provider] = 0;
                        }
                        analysis.byProvider[provider]++;
                        
                        const accuracy = parseFloat(doc.accuracy?.replace('%', '') || '0');
                        totalAccuracy += accuracy;
                        totalConfidence += doc.confidence || 0;
                        
                        if (!analysis.latest || doc.id > analysis.latest.id) {
                            analysis.latest = doc;
                        }
                    });
                    
                    analysis.avgAccuracy = totalAccuracy / docs.length;
                    analysis.avgConfidence = totalConfidence / docs.length;
                    
                    resultDiv.innerHTML = '<span class="status success">‚úÖ Dokumenty naƒçteny</span>';
                    detailsDiv.textContent = JSON.stringify(analysis, null, 2);
                    
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('‚ùå Documents test failed:', error);
                resultDiv.innerHTML = '<span class="status error">‚ùå Naƒç√≠t√°n√≠ selhalo</span>';
                detailsDiv.textContent = `Error: ${error.message}`;
            }
        };

        window.simulateNewUpload = function() {
            const resultDiv = document.getElementById('upload-result');
            const detailsDiv = document.getElementById('upload-details');
            
            resultDiv.innerHTML = '<span class="status info">Simuluji upload...</span>';
            detailsDiv.textContent = '';
            
            const simulation = {
                step1: "‚úÖ U≈æivatel otev≈ôe upload str√°nku (/documents/new)",
                step2: "‚úÖ Automaticky se vybere 'Nejvy≈°≈°√≠ p≈ôesnost (0.30 Kƒç/dok)'",
                step3: "‚úÖ U≈æivatel nahraje PDF fakturu",
                step4: "‚úÖ Frontend po≈°le request s mode='accuracy_first'",
                step5: "‚úÖ Backend pou≈æije Google Vision OCR (99% p≈ôesnost)",
                step6: "‚úÖ Backend se pokus√≠ pou≈æ√≠t Claude 3.5 Sonnet",
                step7: "‚ö†Ô∏è Pokud Claude nen√≠ dostupn√Ω, pou≈æije se Gemini (90% p≈ôesnost)",
                step8: "‚ö†Ô∏è Pokud ani Gemini nen√≠ dostupn√Ω, pou≈æije se regex fallback (60%)",
                step9: "‚úÖ V√Ωsledek se ulo≈æ√≠ do datab√°ze s vy≈°≈°√≠ p≈ôesnost√≠",
                
                expectedResult: {
                    mode: "accuracy_first",
                    ocrProvider: "Google Vision API",
                    llmProvider: "Claude 3.5 Sonnet / Gemini / Regex fallback",
                    expectedAccuracy: "90-95% (s AI) / 60% (fallback)",
                    cost: "~0.30 Kƒç (s AI) / 0.00 Kƒç (fallback)",
                    processingTime: "5-15 sekund",
                    structuredData: "Vy≈°≈°√≠ kvalita extrakce dat",
                    confidence: "0.8-0.95 (s AI) / 0.6 (fallback)"
                },
                
                improvements: {
                    beforeAccuracy: "60% (regex only)",
                    afterAccuracy: "90-95% (with AI)",
                    beforeConfidence: "0.6",
                    afterConfidence: "0.8-0.95",
                    beforeCost: "0.043 Kƒç",
                    afterCost: "0.30 Kƒç",
                    tradeoff: "Vy≈°≈°√≠ n√°klady za v√Ωraznƒõ lep≈°√≠ p≈ôesnost"
                }
            };
            
            resultDiv.innerHTML = '<span class="status success">‚úÖ Simulace dokonƒçena</span>';
            detailsDiv.textContent = JSON.stringify(simulation, null, 2);
        };

        // Auto-run tests on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Page loaded, running document analysis...');
            testCurrentDocuments();
        });
    </script>
</body>
</html>
