<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Delete Functionality</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .loading { background-color: #fff3cd; border-color: #ffeaa7; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        .document-item { 
            border: 1px solid #ddd; 
            padding: 10px; 
            margin: 10px 0; 
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .delete-btn { 
            background: #dc3545; 
            color: white; 
            border: none; 
            padding: 5px 10px; 
            border-radius: 3px; 
            cursor: pointer;
        }
        .delete-btn:hover { background: #c82333; }
        .delete-btn:disabled { background: #6c757d; cursor: not-allowed; }
    </style>
</head>
<body>
    <h1>üóëÔ∏è Test Delete Functionality</h1>
    
    <div class="test-section">
        <h2>1. Test Backend DELETE Endpoint</h2>
        <button onclick="testDeleteEndpoint()">Test DELETE /documents/{id}</button>
        <div id="delete-endpoint-result"></div>
    </div>

    <div class="test-section">
        <h2>2. Test SDK Delete Method</h2>
        <button onclick="testSDKDelete()">Test SDK deleteDocument()</button>
        <div id="sdk-delete-result"></div>
    </div>

    <div class="test-section">
        <h2>3. Test Frontend Integration</h2>
        <button onclick="loadDocuments()">Load Documents</button>
        <div id="documents-list"></div>
        <div id="frontend-result"></div>
    </div>

    <script>
        // Import SDK (simulace)
        class AskelioSDK {
            constructor(baseUrl = 'http://localhost:8001', options = {}) {
                this.baseUrl = baseUrl.replace(/\/$/, '');
                this.options = {
                    timeout: 30000,
                    retries: 3,
                    retryDelay: 1000,
                    ...options
                };
            }

            async getDocuments() {
                return this._makeRequest(`${this.baseUrl}/documents`);
            }

            async deleteDocument(id) {
                return this._makeRequest(`${this.baseUrl}/documents/${id}`, {
                    method: 'DELETE'
                });
            }

            async _makeRequest(url, options = {}) {
                const config = {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    ...options
                };

                const response = await fetch(url, config);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            }
        }

        const sdk = new AskelioSDK();
        let documents = [];

        async function testDeleteEndpoint() {
            const resultDiv = document.getElementById('delete-endpoint-result');
            resultDiv.className = 'loading';
            resultDiv.innerHTML = '<p>üîÑ Testov√°n√≠ DELETE endpointu...</p>';

            try {
                // First get documents to see what we have
                const docs = await fetch('http://localhost:8001/documents');
                const docsData = await docs.json();
                
                if (docsData.length === 0) {
                    resultDiv.className = 'error';
                    resultDiv.innerHTML = '<p>‚ùå ≈Ω√°dn√© dokumenty k testov√°n√≠. Nahrajte nejd≈ô√≠ve nƒõjak√Ω dokument.</p>';
                    return;
                }

                const testDocId = docsData[0].id;
                const testDocName = docsData[0].filename;

                resultDiv.innerHTML = `<p>üîÑ Maz√°n√≠ dokumentu ID: ${testDocId} (${testDocName})...</p>`;

                // Test delete
                const response = await fetch(`http://localhost:8001/documents/${testDocId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                
                resultDiv.className = 'success';
                resultDiv.innerHTML = `
                    <h3>‚úÖ DELETE endpoint funguje!</h3>
                    <p><strong>Smazan√Ω dokument:</strong> ${result.message}</p>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.className = 'error';
                resultDiv.innerHTML = `
                    <h3>‚ùå Chyba DELETE endpointu</h3>
                    <p>${error.message}</p>
                `;
            }
        }

        async function testSDKDelete() {
            const resultDiv = document.getElementById('sdk-delete-result');
            resultDiv.className = 'loading';
            resultDiv.innerHTML = '<p>üîÑ Testov√°n√≠ SDK deleteDocument()...</p>';

            try {
                // First get documents
                const docs = await sdk.getDocuments();
                
                if (docs.length === 0) {
                    resultDiv.className = 'error';
                    resultDiv.innerHTML = '<p>‚ùå ≈Ω√°dn√© dokumenty k testov√°n√≠. Nahrajte nejd≈ô√≠ve nƒõjak√Ω dokument.</p>';
                    return;
                }

                const testDocId = docs[0].id;
                const testDocName = docs[0].filename;

                resultDiv.innerHTML = `<p>üîÑ SDK maz√°n√≠ dokumentu ID: ${testDocId} (${testDocName})...</p>`;

                // Test SDK delete
                const result = await sdk.deleteDocument(testDocId);
                
                resultDiv.className = 'success';
                resultDiv.innerHTML = `
                    <h3>‚úÖ SDK deleteDocument() funguje!</h3>
                    <p><strong>Smazan√Ω dokument:</strong> ${result.message}</p>
                    <pre>${JSON.stringify(result, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.className = 'error';
                resultDiv.innerHTML = `
                    <h3>‚ùå Chyba SDK deleteDocument()</h3>
                    <p>${error.message}</p>
                `;
            }
        }

        async function loadDocuments() {
            const listDiv = document.getElementById('documents-list');
            const resultDiv = document.getElementById('frontend-result');
            
            listDiv.innerHTML = '<p>üîÑ Naƒç√≠t√°n√≠ dokument≈Ø...</p>';
            resultDiv.innerHTML = '';

            try {
                documents = await sdk.getDocuments();
                
                if (documents.length === 0) {
                    listDiv.innerHTML = '<p>üìÑ ≈Ω√°dn√© dokumenty k zobrazen√≠.</p>';
                    return;
                }

                listDiv.innerHTML = `
                    <h4>üìÑ Nalezeno ${documents.length} dokument≈Ø:</h4>
                    ${documents.map(doc => `
                        <div class="document-item" id="doc-${doc.id}">
                            <div>
                                <strong>${doc.filename}</strong><br>
                                <small>ID: ${doc.id} | Status: ${doc.status} | Vytvo≈ôeno: ${new Date(doc.created_at).toLocaleString('cs-CZ')}</small>
                            </div>
                            <button class="delete-btn" onclick="deleteDocument(${doc.id}, '${doc.filename}')" id="delete-btn-${doc.id}">
                                üóëÔ∏è Smazat
                            </button>
                        </div>
                    `).join('')}
                `;
            } catch (error) {
                listDiv.innerHTML = `<p>‚ùå Chyba p≈ôi naƒç√≠t√°n√≠: ${error.message}</p>`;
            }
        }

        async function deleteDocument(docId, docName) {
            const resultDiv = document.getElementById('frontend-result');
            const deleteBtn = document.getElementById(`delete-btn-${docId}`);
            const docItem = document.getElementById(`doc-${docId}`);
            
            if (!confirm(`Opravdu chcete smazat dokument "${docName}"?`)) {
                return;
            }

            deleteBtn.disabled = true;
            deleteBtn.textContent = '‚è≥ Maz√°n√≠...';
            
            resultDiv.className = 'loading';
            resultDiv.innerHTML = `<p>üîÑ Maz√°n√≠ dokumentu "${docName}"...</p>`;

            try {
                const result = await sdk.deleteDocument(docId);
                
                // Remove from UI
                docItem.remove();
                
                resultDiv.className = 'success';
                resultDiv.innerHTML = `
                    <h3>‚úÖ Dokument √∫spƒõ≈°nƒõ smaz√°n!</h3>
                    <p>${result.message}</p>
                `;

                // Update documents array
                documents = documents.filter(doc => doc.id !== docId);
                
                if (documents.length === 0) {
                    document.getElementById('documents-list').innerHTML = '<p>üìÑ ≈Ω√°dn√© dokumenty k zobrazen√≠.</p>';
                }
            } catch (error) {
                deleteBtn.disabled = false;
                deleteBtn.textContent = 'üóëÔ∏è Smazat';
                
                resultDiv.className = 'error';
                resultDiv.innerHTML = `
                    <h3>‚ùå Chyba p≈ôi maz√°n√≠</h3>
                    <p>${error.message}</p>
                `;
            }
        }

        // Auto-load documents on page load
        window.addEventListener('load', () => {
            loadDocuments();
        });
    </script>
</body>
</html>
